{"version":3,"sources":["../../src/middlewares/authMiddleware.ts"],"sourcesContent":["import { NextFunction, Response } from \"express\";\nimport { verify } from \"jsonwebtoken\";\nimport { SECRET_KEY } from \"@/config/env\";\nimport { HttpException } from \"@exceptions/httpException\";\nimport { DataStoredInToken, RequestWithUser } from \"@interfaces/authInterface\";\nimport userModel from \"@/models/User\";\n\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\n    try {\n        const Authorization =\n            req.cookies[\"Authorization\"] ||\n            (req.header(\"Authorization\") ? req.header(\"Authorization\").split(\"Bearer \")[1] : null);\n\n        if (Authorization) {\n            const secretKey: string = SECRET_KEY;\n            const verificationResponse = verify(Authorization, secretKey) as DataStoredInToken;\n            const adminId = verificationResponse._id;\n            const findUser = await userModel.findById(adminId);\n\n            if (findUser) {\n                req.user = findUser;\n                next();\n            } else {\n                next(new HttpException(401, \"Wrong authentication token\"));\n            }\n        } else {\n            next(new HttpException(404, \"Authentication token missing\"));\n        }\n    } catch (error) {\n        next(new HttpException(401, \"Wrong authentication token\"));\n    }\n};\n\nexport default authMiddleware;"],"names":["authMiddleware","req","res","next","Authorization","cookies","header","split","secretKey","SECRET_KEY","verificationResponse","verify","adminId","_id","findUser","userModel","findById","user","HttpException","error"],"mappings":";;;;+BAiCA;;aAAA;;8BAhCuB;qBACI;+BACG;+CAER;;;;;;AAEtB,MAAMA,iBAAiB,OAAOC,KAAsBC,KAAeC,OAAuB;IACtF,IAAI;QACA,MAAMC,gBACFH,IAAII,OAAO,CAAC,gBAAgB,IAC3BJ,CAAAA,IAAIK,MAAM,CAAC,mBAAmBL,IAAIK,MAAM,CAAC,iBAAiBC,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG,IAAI,AAAD;QAExF,IAAIH,eAAe;YACf,MAAMI,YAAoBC,eAAU;YACpC,MAAMC,uBAAuBC,IAAAA,oBAAM,EAACP,eAAeI;YACnD,MAAMI,UAAUF,qBAAqBG,GAAG;YACxC,MAAMC,WAAW,MAAMC,aAAS,CAACC,QAAQ,CAACJ;YAE1C,IAAIE,UAAU;gBACVb,IAAIgB,IAAI,GAAGH;gBACXX;YACJ,OAAO;gBACHA,KAAK,IAAIe,4BAAa,CAAC,KAAK;YAChC,CAAC;QACL,OAAO;YACHf,KAAK,IAAIe,4BAAa,CAAC,KAAK;QAChC,CAAC;IACL,EAAE,OAAOC,OAAO;QACZhB,KAAK,IAAIe,4BAAa,CAAC,KAAK;IAChC;AACJ;MAEA,WAAelB"}